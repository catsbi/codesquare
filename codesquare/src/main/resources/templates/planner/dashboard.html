<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout/plannerLayout}"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
    <title>Dashboard</title>
</head>

<body>

    <article class="content" layout:fragment="myPageContent2">
        <!-- START CUSTOM-TAB 나의 그룹 및 세미나 스케쥴 보기 -->
        <div class="row group-schedule custom-tab">
            <!-- 왼쪽 Nav tabs 부분 -->
            <ul class="nav nav-pills nav-custom-tabs flex-column col-md-1">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="pill" href="#all">전체</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="pill" href="#study">스터디</a>
                </li>
                <li class="nav-item shadow">
                    <a class="nav-link" data-toggle="pill" href="#seminar">세미나</a>
                </li>
            </ul>
			<!-- 오른쪽 컨텐츠 부분 -->
            <div class="tab-content custom-tab-content col-md-11 shadow">
                <div id="all" class="container tab-pane active">
                    <p>all</p>
                    <div class="row">
                        <ul class="col-md-7 schedule-list">
                            <!-- #####  스케쥴의 리스트의 data  ##### -->
                        </ul>
                        <div class="map col-md-5" style="background-color: lightgray; height: 250px">
                        </div>
                    </div>
                </div>
                <div id="study" class="container tab-pane fade">
                   <p>study</p>
                    <div class="row">
                        <ul class="col-md-7 schedule-list">
                            <!-- #####  스케쥴의 리스트의 data  ##### -->
                        </ul>
                        <div class="map col-md-5" style="background-color: lightgray; height: 250px">
                        </div>
                    </div>
                </div>
                <div id="seminar" class="container tab-pane fade">
                    <p>seminar</p>
                    <div class="row">
                        <ul class="col-md-7 schedule-list">
                            <!-- #####  스케쥴의 리스트의 data  ##### -->
                        </ul>
                        <div class="map col-md-5" style="background-color: lightgray; height: 250px">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END CUSTOM-TAB 나의 그룹 및 세미나 스케쥴 보기  -->


        <!-- START CARD-DECK -->
        <div class="rowDash card-deck">
            <div class="card card-stats shadow">
                <div class="card-header">
                    <div class="card-icon card-icon-pink">
                    <div class="svgImg">
                    	<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 60 60" style="enable-background:new 0 0 60 60;" xml:space="preserve" width="56px" height="56px" class=""><g transform="matrix(0.9801 0 0 0.9801 0.596999 0.596999)"><path d="M55.014,45.389l-9.553-4.776C44.56,40.162,44,39.256,44,38.248v-3.381c0.229-0.28,0.47-0.599,0.719-0.951  c1.239-1.75,2.232-3.698,2.954-5.799C49.084,27.47,50,26.075,50,24.5v-4c0-0.963-0.36-1.896-1-2.625v-5.319  c0.056-0.55,0.276-3.824-2.092-6.525C44.854,3.688,41.521,2.5,37,2.5s-7.854,1.188-9.908,3.53c-1.435,1.637-1.918,3.481-2.064,4.805  C23.314,9.949,21.294,9.5,19,9.5c-10.389,0-10.994,8.855-11,9v4.579c-0.648,0.706-1,1.521-1,2.33v3.454  c0,1.079,0.483,2.085,1.311,2.765c0.825,3.11,2.854,5.46,3.644,6.285v2.743c0,0.787-0.428,1.509-1.171,1.915l-6.653,4.173  C1.583,48.134,0,50.801,0,53.703V57.5h14h2h44v-4.043C60,50.019,58.089,46.927,55.014,45.389z M14,53.262V55.5H2v-1.797  c0-2.17,1.184-4.164,3.141-5.233l6.652-4.173c1.333-0.727,2.161-2.121,2.161-3.641v-3.591l-0.318-0.297  c-0.026-0.024-2.683-2.534-3.468-5.955l-0.091-0.396l-0.342-0.22C9.275,29.899,9,29.4,9,28.863v-3.454  c0-0.36,0.245-0.788,0.671-1.174L10,23.938l-0.002-5.38C10.016,18.271,10.537,11.5,19,11.5c2.393,0,4.408,0.553,6,1.644v4.731  c-0.64,0.729-1,1.662-1,2.625v4c0,0.304,0.035,0.603,0.101,0.893c0.027,0.116,0.081,0.222,0.118,0.334  c0.055,0.168,0.099,0.341,0.176,0.5c0.001,0.002,0.002,0.003,0.003,0.005c0.256,0.528,0.629,1,1.099,1.377  c0.005,0.019,0.011,0.036,0.016,0.054c0.06,0.229,0.123,0.457,0.191,0.68l0.081,0.261c0.014,0.046,0.031,0.093,0.046,0.139  c0.035,0.108,0.069,0.215,0.105,0.321c0.06,0.175,0.123,0.356,0.196,0.553c0.031,0.082,0.065,0.156,0.097,0.237  c0.082,0.209,0.164,0.411,0.25,0.611c0.021,0.048,0.039,0.1,0.06,0.147l0.056,0.126c0.026,0.058,0.053,0.11,0.079,0.167  c0.098,0.214,0.194,0.421,0.294,0.621c0.016,0.032,0.031,0.067,0.047,0.099c0.063,0.125,0.126,0.243,0.189,0.363  c0.108,0.206,0.214,0.4,0.32,0.588c0.052,0.092,0.103,0.182,0.154,0.269c0.144,0.246,0.281,0.472,0.414,0.682  c0.029,0.045,0.057,0.092,0.085,0.135c0.242,0.375,0.452,0.679,0.626,0.916c0.046,0.063,0.086,0.117,0.125,0.17  c0.022,0.029,0.052,0.071,0.071,0.097v3.309c0,0.968-0.528,1.856-1.377,2.32l-2.646,1.443l-0.461-0.041l-0.188,0.395l-5.626,3.069  C15.801,46.924,14,49.958,14,53.262z M58,55.5H16v-2.238c0-2.571,1.402-4.934,3.659-6.164l8.921-4.866  C30.073,41.417,31,39.854,31,38.155v-4.018v-0.001l-0.194-0.232l-0.038-0.045c-0.002-0.003-0.064-0.078-0.165-0.21  c-0.006-0.008-0.012-0.016-0.019-0.024c-0.053-0.069-0.115-0.152-0.186-0.251c-0.001-0.002-0.002-0.003-0.003-0.005  c-0.149-0.207-0.336-0.476-0.544-0.8c-0.005-0.007-0.009-0.015-0.014-0.022c-0.098-0.153-0.202-0.32-0.308-0.497  c-0.008-0.013-0.016-0.026-0.024-0.04c-0.226-0.379-0.466-0.808-0.705-1.283c0,0-0.001-0.001-0.001-0.002  c-0.127-0.255-0.254-0.523-0.378-0.802l0,0c-0.017-0.039-0.035-0.077-0.052-0.116h0c-0.055-0.125-0.11-0.256-0.166-0.391  c-0.02-0.049-0.04-0.1-0.06-0.15c-0.052-0.131-0.105-0.263-0.161-0.414c-0.102-0.272-0.198-0.556-0.29-0.849l-0.055-0.178  c-0.006-0.02-0.013-0.04-0.019-0.061c-0.094-0.316-0.184-0.639-0.26-0.971l-0.091-0.396l-0.341-0.22  C26.346,25.803,26,25.176,26,24.5v-4c0-0.561,0.238-1.084,0.67-1.475L27,18.728V12.5v-0.354l-0.027-0.021  c-0.034-0.722,0.009-2.935,1.623-4.776C30.253,5.458,33.081,4.5,37,4.5c3.905,0,6.727,0.951,8.386,2.828  c1.947,2.201,1.625,5.017,1.623,5.041L47,18.728l0.33,0.298C47.762,19.416,48,19.939,48,20.5v4c0,0.873-0.572,1.637-1.422,1.899  l-0.498,0.153l-0.16,0.495c-0.669,2.081-1.622,4.003-2.834,5.713c-0.297,0.421-0.586,0.794-0.837,1.079L42,34.123v4.125  c0,1.77,0.983,3.361,2.566,4.153l9.553,4.776C56.513,48.374,58,50.78,58,53.457V55.5z" data-original="#000000" class="active-path" data-old_color="#FCF8F8" fill="#FDFBFB"/></g> </svg>
                    </div>
                    </div>
                    <p class="card-category">My groups</p>
                    <h1 class="card-title" th:text="${userStats.groupCnt}"></h1>
                </div>
                <div class="card-footer">참여중인 그룹</div>
            </div>

            <div class="card card-stats shadow">
                <div class="card-header">
                    <div class="card-icon card-icon-orange">
						<div class="svgImg">
						    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 295.238 295.238" style="enable-background:new 0 0 295.238 295.238;" xml:space="preserve" width="56px" height="56px"><g><g>
								<g>
									<g>
										<path d="M277.462,0.09l-27.681,20.72l-27.838,64.905h-22.386l-8.79-19.048h5.743c10.505,0,19.048-8.452,19.048-18.957V28.571     h9.524V0H196.51v28.571h9.524V47.71c0,5.248-4.271,9.433-9.524,9.433h-10.138L174.2,30.81l14.581-7.267L141.038,3.095     l-11.224,39.281c-0.305-23.371-19.386-42.29-42.829-42.29c-23.633,0-42.857,19.224-42.857,42.857     c0,14.281,7.233,27.676,19.048,35.595v7.176H51.643L50.9,89.619c-2.314,12.005-2.529,24.343-0.638,36.648l-32.486,57.905     l35.876,8.195v60.014h47.619v42.857h114.286v-66.357c33.333-23.581,52.371-61.495,52.343-101.943l0.01-17.371     c0-6.548-0.605-13.276-1.824-19.905l-0.705-3.948h-9.348l21.429-51.338V0.09z M206.033,19.138V9.614h9.524v9.524H206.033z      M189.067,85.714h-18.062l-8.657-19.048h17.929L189.067,85.714z M147.219,16.119l18.929,8.11l-4.467,2.19l14.2,30.724h-17.862     l-11.605-25.471l-4.262,2.152L147.219,16.119z M160.543,85.715h-21.176v-9.433c0-5.252,4.271-9.614,9.524-9.614h2.995v-0.001     L160.543,85.715z M141.843,44.652l5.776,12.71c-9.905,0.667-17.776,8.848-17.776,18.919v9.433h-19.048v-7.176     c9.529-6.386,15.995-16.352,18.176-27.452L141.843,44.652z M53.653,42.948c0-18.376,14.957-33.333,33.333-33.333     c18.376,0,33.333,14.957,33.333,33.333c0,11.829-6.39,22.881-16.671,28.838l-2.376,1.371v12.557h-9.524V56.352     c5.529-1.971,9.524-7.21,9.524-13.41c0-7.876-6.41-14.286-14.286-14.286c-7.876,0-14.286,6.411-14.286,14.287     c0,6.2,3.995,11.438,9.524,13.41v29.362H72.7V73.157l-2.376-1.376C60.043,65.824,53.653,54.776,53.653,42.948z M86.986,47.71     c-2.629,0-4.762-2.139-4.762-4.762c0-2.629,2.133-4.762,4.762-4.762c2.629,0,4.762,2.133,4.762,4.762S89.615,47.71,86.986,47.71z      M257.366,95.239c0.691,4.761,1.039,9.59,1.039,14.285l0.01,17.405c0.029,38.148-18.795,73.871-50.286,95.552l-2.095,1.429     v61.805h-95.238v-42.857h-47.62v-58.086l-30.862-7.043l27.876-49.7l-0.271-1.7c-1.771-10.419-1.871-21.567-0.333-31.09h3.59     h47.619H257.366z M245.714,85.714H232.3l23.738-55.343l10.557,5.257L245.714,85.714z M267.938,25.714l-5.267-2.633l5.267-3.943     V25.714z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#FDFBFB"/>
										<path d="M96.51,123.81c-7.876,0-14.286-4.762-14.286-14.286H72.7c0,14.286,10.681,23.81,23.81,23.81     c13.129,0,23.81-9.524,23.81-23.81h-9.524C110.795,119.048,104.386,123.81,96.51,123.81z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#FDFBFB"/>
									</g>
								</g>
							</g></g> </svg>
						</div>
                    </div>
                    <p class="card-category">My Seminar</p>
                    <h1 class="card-title" th:text="${userStats.seminarCnt}"></h1>
                </div>
                <div class="card-footer">참여중인 세미나</div>
            </div>

            <div class="card card-stats shadow">
                <div class="card-header">
                    <div class="card-icon card-icon-green">
                       <div class="svgImg">
							<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 58 58" style="enable-background:new 0 0 58 58;" xml:space="preserve" width="56px" height="56px" class=""><g><path d="M57,6H1C0.448,6,0,6.447,0,7v44c0,0.553,0.448,1,1,1h56c0.552,0,1-0.447,1-1V7C58,6.447,57.552,6,57,6z M10,50H2v-9h8V50z   M10,39H2v-9h8V39z M10,28H2v-9h8V28z M10,17H2V8h8V17z M36.537,29.844l-11,7C25.374,36.947,25.187,37,25,37  c-0.166,0-0.331-0.041-0.481-0.123C24.199,36.701,24,36.365,24,36V22c0-0.365,0.199-0.701,0.519-0.877  c0.32-0.175,0.71-0.162,1.019,0.033l11,7C36.825,28.34,37,28.658,37,29S36.825,29.66,36.537,29.844z M56,50h-8v-9h8V50z M56,39h-8  v-9h8V39z M56,28h-8v-9h8V28z M56,17h-8V8h8V17z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#FDFBFB"/></g> </svg>
                       </div>
                    </div>
                    <p class="card-category">My lectures</p>
                    <h1 class="card-title" th:text="${userStats.lectureCnt}"></h1>
                </div>
                <div class="card-footer">진행중인 강의</div>
            </div>

            <div class="card card-stats shadow">
                <div class="card-header">
                    <div class="card-icon card-icon-blue">
                        <i class="fa fa-check"></i>
                    </div>
                    <p class="card-category">My todo-list</p>
                    <h1 class="card-title" th:text="${userStats.todoCnt}"></h1>
                </div>
                <div class="card-footer">해야할 일</div>
            </div>

        </div>
        <!-- END CARD-DECK -->

        <!-- START LECTURE CARD -->
        <div class="rowDash card big-card card-lecture shadow">
            <div class="card-header">
                <p class="card-category">나의 학습 현황</p>
            </div>
            <div class="card-body">
                <div class="lecture-list row" th:each="list : ${cardLecture}">
                    <div class="lecture-description col-md-6">
                        <a th:href="@{'/learn/intro/{lectureId}'(lectureId=${list.parentId})}">
                            <h5 th:text="*{list.title}"></h5>
                        </a>
                            <p class="introContent" th:text="${list.introContent}"></p>
                    </div>

                    <div class="lecture-progress  col-md-6">
                        <p class="small" th:text="*{list.learningRate}+'% Completed'"></p>
                        <div class="progress">
                            <div th:class="'progress-bar '+(${list.learningRate} lt 35? 'bg-warning' : (${list.learningRate} eq 100? 'bg-success' : ''))"
                                th:style="'width:'+@{*{list.learningRate}}+'%'">
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
        <!-- END LECTURE CARD -->
        <!-- START GROUPNOTICE CARD -->
        <div class="card big-card card-nomal shadow">
            <div class="card-header">
                <p class="card-category">그룹 공지사항</p>
            </div>
            <div class="card-body">
                <div class="card-grid groupNotice" th:each="list : ${cardGroupNotice}">
                    <div class="groupNt-groupId">
                        <span th:text="*{list.groupId}"></span>
                    </div>
                    <div class="groupNt-title">
                        <span th:text="*{list.title}"></span>
                        <i class="fa fa-check-circle"></i>
                    </div>
                    <div class="groupNt-content" th:text="*{list.content}"> </div>
                    <div class="groupNt-writeDate writeDate" th:text="*{list.writeDateFormat}"></div>
                </div>
            </div>
        </div>
        <!-- END GROUPNOTICE CARD -->


    </article>

<th:block layout:fragment="css">
	    <link rel="stylesheet" type="text/css" th:href="@{/static/styles/planner/dashboard.css}">
</th:block>
<th:block layout:fragment="script">
  <script type="text/javascript" th:inline="javascript">

        var allSchedule = /*[[${allSchedule}]]*/;
        allSchedule.sort(function (a, b) {
            return a.meetingDate < b.meetingDate ? -1 : 1
        });

        var groupSchedule = allSchedule.filter(function (item) {
            return !('seminarStartDate' in item);
        });

        var seminarSchedule = allSchedule.filter(function (item) {
            return 'seminarStartDate' in item;
        });

        var JSONallSchedule = JSON.stringify(allSchedule);
        
        var viewSchedule = function (objectSchedule, str) {
            /* 
                ############################################
                 스케쥴이 0이거나 객체가 없는 경우 데이터 처리할 로직도 추가해야됨
                ############################################
              */
            $.each(objectSchedule, function (index, item) {
                var isSeminarSchedule = 'seminarStartDate' in item;
                var week = ['일', '월', '화', '수', '목', '금', '토'];
                var el = [
                    ['list__scheduleId', isSeminarSchedule ? '강사' : '그룹명', item.nickname || item.groupId]
                    , ['list__boardKind', '분류', isSeminarSchedule ? '세미나' : '그룹']
                    , ['list__meetingDate', '모임일', new Date(item.meetingDate).getDate() + '일']
                    , ['list__meetingDay', '요일', week[new Date(item.meetingDate).getDay()]]
                    , ['list__status '+(item.status=='none'?'fa fa-exclamation':(item.status==false?'fa fa-close':'fa fa-check')), '상태', '']
                ];
                var html = '';

                $.each(el, function (i, arr) {
                    html += '<div class=\"' + arr[0] + '\" aria-label=\"' + arr[1] + '\">' + arr[2] + '</div>';
                });

                $('#' + str + ' ul').append('<li><a href="#"></a></li>');
                $('#' + str + ' a:last').append(html);
            });
        };//end viewSchedule function

        $(document).ready(function () {
            viewSchedule(allSchedule, 'all');
            viewSchedule(groupSchedule, 'study');
            viewSchedule(seminarSchedule, 'seminar');
        });

        $(function () {
            $(".map").click(function () {
                $.ajax({
                    type: 'post',
                    url: '/test',
                    /* dataType : 'html',  내가 서버에서 받을 데이터값의 타입을 정하는건가? */
                    /* data : {"JSONallScedule":JSONallSchedule, "A" : "A"}, */
                    data: JSONallSchedule,
                    contentType: 'application/json; charset=UTF-8',
/* 					traditional : true,
 */					success: function (data) {
                        $(this).css('background-color', 'red');
                        console.log("##### Ajax SUCCESS #######");
                        console.log(this);
                        console.log(data);
                        console.log(event);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log("##### Ajax ERROR #######");
                    }
                });
            });
        });


    </script>

</th:block>
</body>

</html>